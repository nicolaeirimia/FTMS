<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FTMS - C4 Architecture Diagram</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            overflow: hidden;
        }

        #canvas {
            position: relative;
            width: 100%;
            height: calc(100vh - 120px);
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .header p {
            font-size: 1rem;
            opacity: 0.9;
            margin-top: 8px;
        }

        .box {
            position: absolute;
            padding: 24px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            cursor: default;
            user-select: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            z-index: 10;
            min-width: 160px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .box:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .box-emoji {
            font-size: 2.5rem;
            margin-bottom: 8px;
            display: block;
        }

        .box-header {
            font-size: 1rem;
            margin-bottom: 4px;
            font-weight: 700;
            letter-spacing: -0.01em;
        }

        .box-description {
            font-size: 0.75rem;
            opacity: 0.85;
            line-height: 1.3;
            font-weight: 500;
        }

        /* Actor styles */
        .actor {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 140px;
        }

        /* FTMS main block */
        .ftms-main {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            width: 200px;
            padding: 32px 24px;
        }

        /* Component styles */
        .component {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            width: 180px;
        }

        /* Infrastructure styles */
        .infrastructure {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: #1e293b;
            width: 160px;
        }

        /* Clickable indicator */
        .clickable {
            cursor: pointer;
        }

        .clickable:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 12px 28px rgba(0, 0, 0, 0.2);
        }

        .clickable .box-description::after {
            content: " üëÜ";
        }

        /* Level-based visibility */
        .box {
            display: none;
        }

        .box.visible {
            display: flex;
        }

        /* Context (background) items */
        .box.context {
            opacity: 0.25;
            pointer-events: none;
            transform: scale(0.95);
        }

        /* SVG lines */
        #lines-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .connection-line {
            stroke-width: 2.5;
            stroke-dasharray: 8, 4;
            fill: none;
            opacity: 0.7;
        }

        .arrow {
            opacity: 0.7;
        }

        /* Navigation controls */
        .nav-controls {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            display: flex;
            gap: 16px;
            align-items: center;
            background: rgba(255, 255, 255, 0.98);
            padding: 12px 24px;
            border-radius: 10px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .back-button {
            background: #667eea;
            padding: 8px 18px;
            border-radius: 6px;
            font-weight: 600;
            color: white;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            display: none;
            font-size: 0.875rem;
        }

        .back-button:hover {
            background: #5568d3;
        }

        .back-button.visible {
            display: block;
        }

        .breadcrumb {
            font-weight: 600;
            color: #1e293b;
            font-size: 0.938rem;
        }

        .breadcrumb span {
            color: #667eea;
        }

        /* Fade animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(10px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        /* Instructions */
        .instructions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.98);
            padding: 14px 28px;
            border-radius: 10px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            z-index: 100;
            font-size: 0.875rem;
            text-align: center;
            max-width: 90%;
        }

        .instructions strong {
            color: #667eea;
            display: block;
            margin-bottom: 6px;
            font-size: 0.938rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöõ FTMS Architecture</h1>
        <p>Interactive Multi-Level C4 Diagram</p>
    </div>

    <div id="canvas">
        <svg id="lines-svg"></svg>
        
        <div class="nav-controls">
            <button class="back-button" id="back-button">‚Üê Back</button>
            <div class="breadcrumb" id="breadcrumb">
                <span>Level 1:</span> System Context
            </div>
        </div>

        <!-- Level 1: Actors + FTMS System Block -->
        <div class="box actor" id="fleet-manager" data-level="1">
            <span class="box-emoji">üë®‚Äçüíº</span>
            <div class="box-header">Fleet Manager</div>
            <div class="box-description">Manages fleet operations</div>
        </div>

        <div class="box actor" id="accounting" data-level="1">
            <span class="box-emoji">üí∞</span>
            <div class="box-header">Accounting</div>
            <div class="box-description">Financial records</div>
        </div>

        <div class="box actor" id="client" data-level="1">
            <span class="box-emoji">üë•</span>
            <div class="box-header">Client</div>
            <div class="box-description">End customers</div>
        </div>

        <div class="box ftms-main clickable" id="ftms-system" data-level="1">
            <span class="box-emoji">üöö</span>
            <div class="box-header">FTMS System</div>
            <div class="box-description">Click to explore</div>
        </div>

        <!-- Level 2: FTMS Components -->
        <div class="box component" id="web-client" data-level="2">
            <span class="box-emoji">üíª</span>
            <div class="box-header">Web Client</div>
            <div class="box-description">User interface</div>
        </div>

        <div class="box component" id="backend" data-level="2">
            <span class="box-emoji">‚öôÔ∏è</span>
            <div class="box-header">Backend API</div>
            <div class="box-description">Business logic</div>
        </div>

        <!-- Level 2: Backend Infrastructure -->
        <div class="box infrastructure" id="postgresql" data-level="2">
            <span class="box-emoji">üêò</span>
            <div class="box-header">PostgreSQL</div>
            <div class="box-description">Database</div>
        </div>

        <div class="box infrastructure" id="s3-storage" data-level="2">
            <span class="box-emoji">üì¶</span>
            <div class="box-header">S3 Storage</div>
            <div class="box-description">Object storage</div>
        </div>

        <div class="box infrastructure" id="message-queue" data-level="2">
            <span class="box-emoji">üì®</span>
            <div class="box-header">Message Queue</div>
            <div class="box-description">Async processing</div>
        </div>

        <div class="instructions">
            <strong>üí° How to navigate</strong>
            Click boxes with üëÜ to dive deeper ‚Ä¢ Use ‚Üê Back to return
        </div>
    </div>

    <script>
        let currentLevel = 1;

        // Layout configurations for each level
        const layouts = {
            1: {
                'fleet-manager': { x: 0.15, y: 0.25 },
                'accounting': { x: 0.15, y: 0.5 },
                'client': { x: 0.15, y: 0.75 },
                'ftms-system': { x: 0.65, y: 0.5 }
            },
            2: {
                'web-client': { x: 0.2, y: 0.5 },
                'backend': { x: 0.5, y: 0.5 },
                'postgresql': { x: 0.725, y: 0.3 },
                's3-storage': { x: 0.725, y: 0.5 },
                'message-queue': { x: 0.725, y: 0.7 }
            }
        };

        // Connection definitions per level
        const connections = {
            1: [
                { from: 'fleet-manager', to: 'ftms-system', color: '#667eea' },
                { from: 'accounting', to: 'ftms-system', color: '#764ba2' },
                { from: 'client', to: 'ftms-system', color: '#667eea' }
            ],
            2: [
                { from: 'web-client', to: 'backend', color: '#f5576c' },
                { from: 'backend', to: 'postgresql', color: '#4facfe' },
                { from: 'backend', to: 's3-storage', color: '#00f2fe' },
                { from: 'backend', to: 'message-queue', color: '#43e97b' }
            ]
        };

        // Initialize
        function init() {
            const clickableBoxes = document.querySelectorAll('.clickable');
            clickableBoxes.forEach(box => {
                box.addEventListener('click', handleClick);
            });
            
            document.getElementById('back-button').addEventListener('click', stepOut);
            window.addEventListener('resize', () => {
                positionBoxes();
                drawLines();
            });

            showLevel(1);
        }

        // Position boxes based on layout configuration
        function positionBoxes() {
            const canvas = document.getElementById('canvas');
            const canvasRect = canvas.getBoundingClientRect();
            const layout = layouts[currentLevel];

            Object.keys(layout).forEach(boxId => {
                const box = document.getElementById(boxId);
                if (!box) return;

                const pos = layout[boxId];
                const boxWidth = box.offsetWidth;
                const boxHeight = box.offsetHeight;

                // Calculate position (centered)
                const left = (canvasRect.width * pos.x) - (boxWidth / 2);
                const top = (canvasRect.height * pos.y) - (boxHeight / 2);

                box.style.left = left + 'px';
                box.style.top = top + 'px';
            });
        }

        // Click handler for step-in navigation
        function handleClick(e) {
            const box = e.currentTarget;
            
            if (box.id === 'ftms-system' && currentLevel === 1) {
                stepInto(2);
            }
        }

        // Step into a deeper level
        function stepInto(targetLevel) {
            currentLevel = targetLevel;
            showLevel(targetLevel);
        }

        // Step out to previous level
        function stepOut() {
            if (currentLevel === 1) return;
            currentLevel--;
            showLevel(currentLevel);
        }

        // Show boxes for specific level
        function showLevel(level) {
            const allBoxes = document.querySelectorAll('.box');
            const backButton = document.getElementById('back-button');
            const breadcrumb = document.getElementById('breadcrumb');
            
            // Update UI elements
            if (level === 1) {
                backButton.classList.remove('visible');
                breadcrumb.innerHTML = '<span>Level 1:</span> System Context';
            } else if (level === 2) {
                backButton.classList.add('visible');
                breadcrumb.innerHTML = '<span>Level 2:</span> Container Diagram';
            }
            
            // Show appropriate boxes
            allBoxes.forEach(box => {
                const boxLevel = parseInt(box.getAttribute('data-level'));
                box.classList.remove('visible', 'context', 'fade-in');
                
                if (boxLevel === level) {
                    box.classList.add('visible', 'fade-in');
                } else if (layouts[level] && layouts[level][box.id]) {
                    // Show as context if it appears in current level layout
                    box.classList.add('visible', 'context');
                }
            });
            
            // Position and draw after a brief delay
            setTimeout(() => {
                positionBoxes();
                drawLines();
            }, 50);
        }

        // Draw connection lines
        function drawLines() {
            const svg = document.getElementById('lines-svg');
            svg.innerHTML = '';

            const levelConnections = connections[currentLevel] || [];

            levelConnections.forEach(conn => {
                const fromElem = document.getElementById(conn.from);
                const toElem = document.getElementById(conn.to);

                if (!fromElem || !toElem) return;
                if (!fromElem.classList.contains('visible') || !toElem.classList.contains('visible')) return;

                const fromRect = fromElem.getBoundingClientRect();
                const toRect = toElem.getBoundingClientRect();
                const canvas = document.getElementById('canvas').getBoundingClientRect();

                // Calculate center points
                const x1 = fromRect.left + fromRect.width / 2 - canvas.left;
                const y1 = fromRect.top + fromRect.height / 2 - canvas.top;
                const x2 = toRect.left + toRect.width / 2 - canvas.left;
                const y2 = toRect.top + toRect.height / 2 - canvas.top;

                // Calculate edge points
                const angle = Math.atan2(y2 - y1, x2 - x1);
                const fromEdgeX = x1 + (fromRect.width / 2) * Math.cos(angle);
                const fromEdgeY = y1 + (fromRect.height / 2) * Math.sin(angle);
                const toEdgeX = x2 - (toRect.width / 2) * Math.cos(angle);
                const toEdgeY = y2 - (toRect.height / 2) * Math.sin(angle);

                // Create straight line
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', fromEdgeX);
                line.setAttribute('y1', fromEdgeY);
                line.setAttribute('x2', toEdgeX);
                line.setAttribute('y2', toEdgeY);
                line.setAttribute('class', 'connection-line');
                line.setAttribute('stroke', conn.color);
                
                svg.appendChild(line);

                // Add arrowhead
                const arrowSize = 10;
                const arrow = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                
                const points = [
                    [toEdgeX, toEdgeY],
                    [toEdgeX - arrowSize * Math.cos(angle - Math.PI / 6), toEdgeY - arrowSize * Math.sin(angle - Math.PI / 6)],
                    [toEdgeX - arrowSize * Math.cos(angle + Math.PI / 6), toEdgeY - arrowSize * Math.sin(angle + Math.PI / 6)]
                ];
                
                arrow.setAttribute('points', points.map(p => p.join(',')).join(' '));
                arrow.setAttribute('fill', conn.color);
                arrow.setAttribute('class', 'arrow');
                
                svg.appendChild(arrow);
            });
        }

        // Start
        init();
    </script>
</body>
</html>